<div *ngIf="wishList">
  <h1>
    {{ wishList.name }}
  </h1>

  <app-gift-create-form
    *ngIf="isCurrentUser"
    [wishListId]="wishListId"
    (onSuccess)="onGiftCreateSuccess()">
  </app-gift-create-form>

  <div dragula="bag-one" [dragulaModel]="gifts">
    <gd-card *ngFor="let gift of gifts">
      <gd-card-title>
        <del *ngIf="gift.isReceived">{{ gift.name }}</del>
        <span *ngIf="!gift.isReceived">{{ gift.name }}</span>
      </gd-card-title>
      <gd-card-body>

        <div *ngIf="!gift.isReceived">
          <div *ngIf="gift.budget">
            Budget: ${{ gift.budget }}
          </div>
          <div *ngIf="gift.priority">
            Priority: {{ gift.priority }}
          </div>
          <div>
            Quantity: {{ gift.quantity }}
          </div>
          <div>
            Order: {{ gift.orderInWishList }}
          </div>
        </div>

        <div *ngIf="gift.externalUrls && !gift.isReceived">
          <app-row *ngFor="let externalUrl of gift.externalUrls">
            <app-column screenXSmall="10" screenSmall="11">
              <a style="max-width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;display:block;" href="{{ externalUrl.url }}">{{ externalUrl.url }}</a>
            </app-column>
            <app-column screenXSmall="2" screenSmall="1">
              <app-gift-external-url-price
                [gift]="gift"
                [externalUrl]="externalUrl">
              </app-gift-external-url-price>
            </app-column>
          </app-row>
        </div>

      </gd-card-body>

      <gd-card-footer>
        <app-button-container *ngIf="isCurrentUser">
          <app-button (click)="toggleReceived(gift)" styleType="primary">
            <span *ngIf="!gift.isReceived">Mark received</span>
            <span *ngIf="gift.isReceived === true">Undo received</span>
          </app-button>
          <span *ngIf="!gift.isReceived">
            <app-button (click)="activeGift = gift">Edit</app-button>
            <app-button (click)="deleteGift(gift._id)">Delete</app-button>
          </span>
          <div class="gd-drag-handle">
            (Drag)
          </div>
        </app-button-container>

        <app-dib-controls
          *ngIf="!isCurrentUser && dibs"
          [gift]="gift"
          [dibs]="filterDibsByGiftId(gift._id)"
          (onChanges)="onDibChanges($event)"
          (onError)="onDibError($event)">
        </app-dib-controls>
      </gd-card-footer>
    </gd-card>
  </div>

  <app-modal *ngIf="activeGift">
    <app-gift-edit-form
      [gift]="activeGift"
      (onSuccess)="onGiftEditSuccess($event)"
      (onCancel)="activeGift = undefined">
    </app-gift-edit-form>
  </app-modal>
</div>
